# å‰ç«¯é›†æˆæ–¹æ¡ˆ

## ä¸€ã€é›¶ä¾µå…¥é›†æˆè®¾è®¡

### 1.1 æ ¸å¿ƒç†å¿µ

**å®Œå…¨ä¸éœ€è¦ä¿®æ”¹å‰ç«¯ä»£ç **ï¼Œé€šè¿‡ä»¥ä¸‹æ–¹å¼å®ç°ï¼š

1. **ç¯å¢ƒå˜é‡åˆ‡æ¢**ï¼šä»…æ”¹å˜ API Base URL
2. **ä»£ç†æ¨¡å¼**ï¼šä½œä¸ºä¸­é—´å±‚é€æ˜è½¬å‘è¯·æ±‚
3. **çƒ­æ’æ‹”**ï¼šå¯åŠ¨/åœæ­¢ Mock æœåŠ¡å™¨ä¸å½±å“å‰ç«¯

### 1.2 é›†æˆæ–¹å¼å¯¹æ¯”

| é›†æˆæ–¹å¼       | å‰ç«¯ä»£ç ä¿®æ”¹   | é…ç½®å¤æ‚åº¦ | çµæ´»æ€§ |
| -------------- | -------------- | ---------- | ------ |
| ä¼ ç»Ÿ MSW       | éœ€è¦å¯¼å…¥å’Œé…ç½® | é«˜         | ä¸­     |
| ä»£ç†æ¨¡å¼       | **é›¶ä¿®æ”¹**     | ä½         | é«˜     |
| Service Worker | éœ€è¦æ³¨å†Œ       | ä¸­         | ä½     |
| ç¯å¢ƒå˜é‡       | **é›¶ä¿®æ”¹**     | æä½       | æé«˜   |

---

## äºŒã€é›†æˆæ–¹æ¡ˆè¯¦è§£

### 2.1 æ–¹æ¡ˆä¸€ï¼šç¯å¢ƒå˜é‡åˆ‡æ¢ï¼ˆæ¨èï¼‰

#### 2.1.1 React åº”ç”¨

```bash
# .env.development
REACT_APP_API_URL=http://localhost:4000

# .env.production
REACT_APP_API_URL=https://api.example.com
```

```typescript
// src/config/api.ts
export const API_BASE_URL =
  process.env.REACT_APP_API_URL || 'https://api.example.com'

export const apiClient = axios.create({
  baseURL: API_BASE_URL,
  timeout: 30000,
})

// ä½¿ç”¨
export const fetchUsers = async () => {
  const response = await apiClient.get('/api/users')
  return response.data
}
```

#### 2.1.2 Vue åº”ç”¨

```bash
# .env.development
VITE_API_URL=http://localhost:4000

# .env.production
VITE_API_URL=https://api.example.com
```

```typescript
// src/config/api.ts
export const API_BASE_URL =
  import.meta.env.VITE_API_URL || 'https://api.example.com'

export const apiClient = axios.create({
  baseURL: API_BASE_URL,
})
```

#### 2.1.3 Angular åº”ç”¨

```bash
# src/environments/environment.ts
export const environment = {
  production: false,
  apiUrl: 'http://localhost:4000',
}

# src/environments/environment.prod.ts
export const environment = {
  production: true,
  apiUrl: 'https://api.example.com',
}
```

```typescript
// src/app/services/api.service.ts
import { environment } from '../environments/environment'

@Injectable({ providedIn: 'root' })
export class ApiService {
  private apiUrl = environment.apiUrl

  constructor(private http: HttpClient) {}

  getUsers() {
    return this.http.get(`${this.apiUrl}/api/users`)
  }
}
```

### 2.2 æ–¹æ¡ˆäºŒï¼šå¯åŠ¨è„šæœ¬

#### 2.2.1 package.json é…ç½®

```json
{
  "scripts": {
    "start": "react-scripts start",
    "start:mock": "REACT_APP_API_URL=http://localhost:4000 react-scripts start",
    "start:prod": "REACT_APP_API_URL=https://api.example.com react-scripts start",
    "build": "react-scripts build",
    "test": "react-scripts test"
  }
}
```

#### 2.2.2 ä¸€é”®å¯åŠ¨è„šæœ¬

```bash
#!/bin/bash

# start-dev.sh

echo "ğŸš€ Starting development environment..."

# 1. æ£€æŸ¥ Mock æœåŠ¡å™¨æ˜¯å¦è¿è¡Œ
if ! curl -s http://localhost:4000/health > /dev/null; then
  echo "ğŸ“¡ Starting Mock Server..."
  cd ../smart-mock-server
  npm run dev &
  MOCK_PID=$!
  echo "Mock Server PID: $MOCK_PID"

  # ç­‰å¾…æœåŠ¡å™¨å¯åŠ¨
  echo "â³ Waiting for Mock Server to start..."
  sleep 5
fi

# 2. å¯åŠ¨å‰ç«¯åº”ç”¨
echo "ğŸ¨ Starting Frontend App..."
cd ../frontend-app
REACT_APP_API_URL=http://localhost:4000 npm start

# æ¸…ç†
trap "kill $MOCK_PID" EXIT
```

### 2.3 æ–¹æ¡ˆä¸‰ï¼šDocker Compose

```yaml
# docker-compose.dev.yml
version: '3.8'

services:
  mock-server:
    build: ./smart-mock-server
    ports:
      - '4000:4000'
      - '4001:4001'
    environment:
      - NODE_ENV=development
      - BACKEND_URL=http://backend:3000
      - CLAUDE_API_KEY=${CLAUDE_API_KEY}
    volumes:
      - ./smart-mock-server/data:/app/data
    networks:
      - dev-network

  backend:
    build: ./backend-app
    ports:
      - '3000:3000'
    environment:
      - NODE_ENV=development
    networks:
      - dev-network

  frontend:
    build: ./frontend-app
    ports:
      - '3000:3000'
    environment:
      - REACT_APP_API_URL=http://mock-server:4000
    depends_on:
      - mock-server
    networks:
      - dev-network

networks:
  dev-network:
    driver: bridge
```

---

## ä¸‰ã€ä¸åŒæ¡†æ¶çš„é›†æˆç¤ºä¾‹

### 3.1 React + TypeScript

```typescript
// src/config/api.ts
const API_BASE_URL = process.env.REACT_APP_API_URL || 'https://api.example.com'

export const api = axios.create({
  baseURL: API_BASE_URL,
  headers: {
    'Content-Type': 'application/json',
  },
})

// è¯·æ±‚æ‹¦æˆªå™¨
api.interceptors.request.use((config) => {
  const token = localStorage.getItem('token')
  if (token) {
    config.headers.Authorization = `Bearer ${token}`
  }
  return config
})

// å“åº”æ‹¦æˆªå™¨
api.interceptors.response.use(
  (response) => response,
  (error) => {
    if (error.response?.status === 401) {
      // å¤„ç†æœªæˆæƒ
      window.location.href = '/login'
    }
    return Promise.reject(error)
  },
)

// API æœåŠ¡
export const userService = {
  getUsers: () => api.get('/api/users'),
  getUser: (id: string) => api.get(`/api/users/${id}`),
  createUser: (data: any) => api.post('/api/users', data),
  updateUser: (id: string, data: any) => api.put(`/api/users/${id}`, data),
  deleteUser: (id: string) => api.delete(`/api/users/${id}`),
}
```

### 3.2 Vue 3 + Composition API

```typescript
// src/composables/useApi.ts
import { ref } from 'vue'
import axios from 'axios'

const API_BASE_URL = import.meta.env.VITE_API_URL || 'https://api.example.com'

const api = axios.create({
  baseURL: API_BASE_URL,
})

export function useApi() {
  const loading = ref(false)
  const error = ref<Error | null>(null)

  const request = async <T>(url: string, options?: any): Promise<T> => {
    loading.value = true
    error.value = null

    try {
      const response = await api(url, options)
      return response.data
    } catch (err) {
      error.value = err as Error
      throw err
    } finally {
      loading.value = false
    }
  }

  return {
    api,
    loading,
    error,
    request,
  }
}
```

```typescript
// src/services/user.service.ts
import { useApi } from '@/composables/useApi'

export function useUserService() {
  const { request, loading, error } = useApi()

  const getUsers = () => request('/api/users')
  const getUser = (id: string) => request(`/api/users/${id}`)
  const createUser = (data: any) =>
    request('/api/users', {
      method: 'POST',
      data,
    })
  const updateUser = (id: string, data: any) =>
    request(`/api/users/${id}`, {
      method: 'PUT',
      data,
    })
  const deleteUser = (id: string) =>
    request(`/api/users/${id}`, {
      method: 'DELETE',
    })

  return {
    getUsers,
    getUser,
    createUser,
    updateUser,
    deleteUser,
    loading,
    error,
  }
}
```

### 3.3 Angular + RxJS

```typescript
// src/app/services/api.service.ts
import { Injectable } from '@angular/core'
import { HttpClient, HttpErrorResponse } from '@angular/common/http'
import { Observable, throwError, catchError } from 'rxjs'
import { environment } from '../../environments/environment'

@Injectable({
  providedIn: 'root',
})
export class ApiService {
  private apiUrl = environment.apiUrl

  constructor(private http: HttpClient) {}

  private handleError(error: HttpErrorResponse) {
    if (error.error instanceof ErrorEvent) {
      // å®¢æˆ·ç«¯é”™è¯¯
      console.error('An error occurred:', error.error.message)
    } else {
      // æœåŠ¡ç«¯é”™è¯¯
      console.error(
        `Backend returned code ${error.status}, ` + `body was: ${error.error}`,
      )
    }
    return throwError(() => 'Something bad happened; please try again later.')
  }

  get<T>(url: string): Observable<T> {
    return this.http
      .get<T>(`${this.apiUrl}${url}`)
      .pipe(catchError(this.handleError))
  }

  post<T>(url: string, data: any): Observable<T> {
    return this.http
      .post<T>(`${this.apiUrl}${url}`, data)
      .pipe(catchError(this.handleError))
  }

  put<T>(url: string, data: any): Observable<T> {
    return this.http
      .put<T>(`${this.apiUrl}${url}`, data)
      .pipe(catchError(this.handleError))
  }

  delete<T>(url: string): Observable<T> {
    return this.http
      .delete<T>(`${this.apiUrl}${url}`)
      .pipe(catchError(this.handleError))
  }
}
```

```typescript
// src/app/services/user.service.ts
import { Injectable } from '@angular/core'
import { Observable } from 'rxjs'
import { ApiService } from './api.service'
import { User } from '../models/user.model'

@Injectable({
  providedIn: 'root',
})
export class UserService {
  constructor(private api: ApiService) {}

  getUsers(): Observable<User[]> {
    return this.api.get<User[]>('/api/users')
  }

  getUser(id: string): Observable<User> {
    return this.api.get<User>(`/api/users/${id}`)
  }

  createUser(user: Partial<User>): Observable<User> {
    return this.api.post<User>('/api/users', user)
  }

  updateUser(id: string, user: Partial<User>): Observable<User> {
    return this.api.put<User>(`/api/users/${id}`, user)
  }

  deleteUser(id: string): Observable<void> {
    return this.api.delete<void>(`/api/users/${id}`)
  }
}
```

### 3.4 Svelte + Stores

```typescript
// src/stores/api.ts
import { writable } from 'svelte/store'
import axios from 'axios'

const API_BASE_URL = import.meta.env.VITE_API_URL || 'https://api.example.com'

const api = axios.create({
  baseURL: API_BASE_URL,
})

export const apiStore = writable({
  get: <T>(url: string) => api.get<T>(url).then((res) => res.data),
  post: <T>(url: string, data: any) =>
    api.post<T>(url, data).then((res) => res.data),
  put: <T>(url: string, data: any) =>
    api.put<T>(url, data).then((res) => res.data),
  delete: <T>(url: string) => api.delete<T>(url).then((res) => res.data),
})
```

---

## å››ã€å¼€å‘å·¥ä½œæµ

### 4.1 å…¸å‹å¼€å‘æµç¨‹

```
1. å¯åŠ¨ Mock æœåŠ¡å™¨
   cd smart-mock-server
   npm run dev

2. å¯åŠ¨å‰ç«¯åº”ç”¨ï¼ˆè‡ªåŠ¨è¿æ¥åˆ° Mockï¼‰
   cd frontend-app
   npm run dev

3. æ‰“å¼€ Web UI
   http://localhost:4001

4. åœ¨å‰ç«¯åº”ç”¨ä¸­å‘èµ·è¯·æ±‚

5. åœ¨ Web UI ä¸­æŸ¥çœ‹è¯·æ±‚

6. ä½¿ç”¨ Claude AI ç”Ÿæˆ Mock

7. ç»§ç»­å¼€å‘
```

### 4.2 å›¢é˜Ÿåä½œæµç¨‹

```
1. å›¢é˜Ÿæˆå‘˜æ‹‰å–ä»£ç 
   git clone project-repo
   cd project-repo

2. å¯åŠ¨ Mock æœåŠ¡å™¨ï¼ˆå…±äº«æ•°æ®åº“ï¼‰
   cd smart-mock-server
   npm run dev

3. å„è‡ªå¯åŠ¨å‰ç«¯åº”ç”¨
   cd member-1/frontend
   npm run dev

   cd member-2/frontend
   npm run dev

4. æ‰€æœ‰æˆå‘˜å…±äº« Mock æ•°æ®å’Œé…ç½®

5. åœ¨ Web UI ä¸­åä½œåˆ›å»º Mock
```

### 4.3 æµ‹è¯•æµç¨‹

```typescript
// tests/setup.ts
import { beforeAll, afterAll } from 'vitest'
import axios from 'axios'

const API_BASE_URL = process.env.API_URL || 'http://localhost:4000'

const api = axios.create({
  baseURL: API_BASE_URL,
})

export const testApi = {
  get: (url: string) => api.get(url),
  post: (url: string, data: any) => api.post(url, data),
  put: (url: string, data: any) => api.put(url, data),
  delete: (url: string) => api.delete(url),
}

// tests/users.test.ts
import { describe, it, expect, beforeEach, afterEach } from 'vitest'
import { testApi } from '../setup'

describe('User API', () => {
  let userId: string

  beforeEach(async () => {
    // åˆ›å»ºæµ‹è¯•æ•°æ®
    const response = await testApi.post('/api/users', {
      name: 'Test User',
      email: 'test@example.com',
    })
    userId = response.data.id
  })

  afterEach(async () => {
    // æ¸…ç†æµ‹è¯•æ•°æ®
    await testApi.delete(`/api/users/${userId}`)
  })

  it('should get users', async () => {
    const response = await testApi.get('/api/users')
    expect(response.status).toBe(200)
    expect(Array.isArray(response.data)).toBe(true)
  })

  it('should create user', async () => {
    const response = await testApi.post('/api/users', {
      name: 'New User',
      email: 'new@example.com',
    })
    expect(response.status).toBe(201)
    expect(response.data.name).toBe('New User')
  })
})
```

---

## äº”ã€é«˜çº§é›†æˆåœºæ™¯

### 5.1 å¤šç¯å¢ƒé…ç½®

```typescript
// src/config/environments.ts
export const environments = {
  development: {
    apiUrl: 'http://localhost:4000',
    enableMock: true,
  },
  staging: {
    apiUrl: 'https://staging-api.example.com',
    enableMock: false,
  },
  production: {
    apiUrl: 'https://api.example.com',
    enableMock: false,
  },
}

export const getCurrentEnvironment = () => {
  const env = process.env.NODE_ENV || 'development'
  return environments[env as keyof typeof environments]
}

export const config = {
  ...getCurrentEnvironment(),
  appVersion: process.env.REACT_APP_VERSION || '1.0.0',
}
```

### 5.2 åŠ¨æ€åˆ‡æ¢ Mock/çœŸå®åç«¯

```typescript
// src/services/api-toggle.service.ts
class ApiToggleService {
  private useMock = localStorage.getItem('USE_MOCK') === 'true'
  private listeners: Array<(useMock: boolean) => void> = []

  toggle() {
    this.useMock = !this.useMock
    localStorage.setItem('USE_MOCK', this.useMock.toString())
    this.notifyListeners()
    window.location.reload() // é‡æ–°åŠ è½½ä»¥åº”ç”¨æ›´æ”¹
  }

  isUsingMock(): boolean {
    return this.useMock
  }

  getApiUrl(): string {
    return this.useMock
      ? 'http://localhost:4000'
      : process.env.REACT_APP_API_URL || 'https://api.example.com'
  }

  subscribe(listener: (useMock: boolean) => void) {
    this.listeners.push(listener)
    return () => {
      this.listeners = this.listeners.filter((l) => l !== listener)
    }
  }

  private notifyListeners() {
    this.listeners.forEach((listener) => listener(this.useMock))
  }
}

export const apiToggleService = new ApiToggleService()
```

### 5.3 æ¸è¿›å¼ Mock

```typescript
// src/config/proxy-config.ts
export interface ProxyRule {
  pattern: RegExp
  useMock: boolean
}

export const proxyRules: ProxyRule[] = [
  {
    pattern: /^\/api\/users\/.*/,
    useMock: true, // ç”¨æˆ·ç›¸å…³ä½¿ç”¨ Mock
  },
  {
    pattern: /^\/api\/products\/.*/,
    useMock: false, // äº§å“ç›¸å…³ä½¿ç”¨çœŸå®åç«¯
  },
]

export const shouldUseMock = (url: string): boolean => {
  for (const rule of proxyRules) {
    if (rule.pattern.test(url)) {
      return rule.useMock
    }
  }
  return false // é»˜è®¤ä¸ä½¿ç”¨ Mock
}

// src/services/api.service.ts
import axios, { AxiosInstance } from 'axios'
import { shouldUseMock } from '../config/proxy-config'

class ApiService {
  private realApi: AxiosInstance
  private mockApi: AxiosInstance

  constructor() {
    this.realApi = axios.create({
      baseURL: process.env.REACT_APP_API_URL,
    })

    this.mockApi = axios.create({
      baseURL: 'http://localhost:4000',
    })
  }

  private getApi(url: string): AxiosInstance {
    return shouldUseMock(url) ? this.mockApi : this.realApi
  }

  get(url: string) {
    return this.getApi(url).get(url)
  }

  post(url: string, data: any) {
    return this.getApi(url).post(url, data)
  }

  put(url: string, data: any) {
    return this.getApi(url).put(url, data)
  }

  delete(url: string) {
    return this.getApi(url).delete(url)
  }
}

export const apiService = new ApiService()
```

---

## å…­ã€è°ƒè¯•å’Œç›‘æ§

### 6.1 å¼€å‘å·¥å…·é›†æˆ

```typescript
// src/utils/devtools.ts
if (process.env.NODE_ENV === 'development') {
  // React DevTools
  if (typeof window !== 'undefined') {
    window.__API_MOCK_ENABLED__ = true
    window.__MOCK_SERVER_URL__ = 'http://localhost:4000'
    window.__MOCK_UI_URL__ = 'http://localhost:4001'
  }

  // æ·»åŠ æ§åˆ¶å°å‘½ä»¤
  console.log(
    '%cğŸ­ Mock Server Integration',
    'color: #00ff00; font-size: 16px; font-weight: bold',
  )
  console.log('%cMock Server:', 'color: #00aaff', 'http://localhost:4000')
  console.log('%cWeb UI:', 'color: #ffaa00', 'http://localhost:4001')
  console.log('%c', 'font-size: 12px', 'Available commands:')
  console.log('%c- toggleMock()', 'color: #00aaff', 'Toggle between mock/real')
  console.log('%c- openMockUI()', 'color: #00aaff', 'Open Mock Web UI')

  // å…¨å±€å‡½æ•°
  ;(window as any).toggleMock = () => {
    apiToggleService.toggle()
  }
  ;(window as any).openMockUI = () => {
    window.open('http://localhost:4001', '_blank')
  }
}
```

### 6.2 è¯·æ±‚æ—¥å¿—

```typescript
// src/middleware/request-logger.ts
import axios from 'axios'

const requestLogger = (config: any) => {
  if (process.env.NODE_ENV === 'development') {
    console.group(`ğŸ“¤ [${config.method.toUpperCase()}] ${config.url}`)
    console.log('Headers:', config.headers)
    if (config.data) {
      console.log('Body:', config.data)
    }
    console.groupEnd()
  }
  return config
}

const responseLogger = (response: any) => {
  if (process.env.NODE_ENV === 'development') {
    console.group(
      `ğŸ“¥ [${response.config.method.toUpperCase()}] ${response.config.url}`,
    )
    console.log('Status:', response.status)
    console.log('Response:', response.data)
    console.groupEnd()
  }
  return response
}

const errorLogger = (error: any) => {
  if (process.env.NODE_ENV === 'development') {
    console.group(
      `âŒ [${error.config?.method?.toUpperCase()}] ${error.config?.url}`,
    )
    console.log('Error:', error.message)
    console.log('Response:', error.response?.data)
    console.groupEnd()
  }
  return Promise.reject(error)
}

// åº”ç”¨åˆ° axios å®ä¾‹
api.interceptors.request.use(requestLogger)
api.interceptors.response.use(responseLogger, errorLogger)
```

---

## ä¸ƒã€æœ€ä½³å®è·µ

### 7.1 é…ç½®ç®¡ç†

```typescript
// âœ… å¥½çš„åšæ³•
export const config = {
  apiUrl: process.env.REACT_APP_API_URL,
  timeout: 30000,
  retries: 3,
}

// âŒ ä¸å¥½çš„åšæ³•
export const API_URL = 'http://localhost:4000'
```

### 7.2 ç¯å¢ƒå˜é‡å‘½å

```bash
# âœ… ä½¿ç”¨ç»Ÿä¸€çš„å‘½åè§„èŒƒ
REACT_APP_API_URL
VITE_API_URL
NG_APP_API_URL

# âŒ é¿å…ä½¿ç”¨æ¨¡ç³Šçš„å‘½å
API_BASE
BACKEND_URL
SERVER_ADDRESS
```

### 7.3 é”™è¯¯å¤„ç†

```typescript
// âœ… å¥½çš„åšæ³•
api.interceptors.response.use(
  (response) => response,
  (error) => {
    if (error.response?.status === 401) {
      // å¤„ç†è®¤è¯é”™è¯¯
    } else if (error.response?.status === 404) {
      // å¤„ç†èµ„æºæœªæ‰¾åˆ°
    } else {
      // å¤„ç†å…¶ä»–é”™è¯¯
    }
    return Promise.reject(error)
  },
)

// âŒ ä¸å¥½çš„åšæ³•
api.interceptors.response.use(
  (response) => response,
  (error) => {
    console.error(error)
    return Promise.reject(error)
  },
)
```

---

## å…«ã€æ€»ç»“

è¿™ä¸ªå‰ç«¯é›†æˆæ–¹æ¡ˆæä¾›äº†ï¼š

âœ… **é›¶ä¾µå…¥æ€§**ï¼šå®Œå…¨ä¸éœ€è¦ä¿®æ”¹å‰ç«¯ä»£ç 
âœ… **çµæ´»æ€§**ï¼šæ”¯æŒå¤šç§é›†æˆæ–¹å¼
âœ… **æ¡†æ¶æ— å…³**ï¼šæ”¯æŒæ‰€æœ‰ä¸»æµå‰ç«¯æ¡†æ¶
âœ… **æ˜“äºåˆ‡æ¢**ï¼šä¸€é”®åˆ‡æ¢ Mock/çœŸå®åç«¯
âœ… **å›¢é˜Ÿåä½œ**ï¼šæ”¯æŒå¤šäººå…±äº« Mock æ•°æ®
âœ… **å¼€å‘å‹å¥½**ï¼šå®Œå–„çš„è°ƒè¯•å’Œç›‘æ§å·¥å…·

å…³é”®ä¼˜åŠ¿ï¼š

- **ç¯å¢ƒå˜é‡**ï¼šæœ€ç®€å•ã€æœ€å¹²å‡€çš„æ–¹å¼
- **å¯åŠ¨è„šæœ¬**ï¼šä¸€é”®å¯åŠ¨å¼€å‘ç¯å¢ƒ
- **Docker Compose**ï¼šå®Œæ•´çš„å®¹å™¨åŒ–è§£å†³æ–¹æ¡ˆ
- **æ¸è¿›å¼ Mock**ï¼šå¯ä»¥éƒ¨åˆ†ä½¿ç”¨ Mockã€éƒ¨åˆ†ä½¿ç”¨çœŸå®åç«¯
