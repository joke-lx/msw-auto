{"version":3,"sources":["../../src/server/index.ts","../../src/server/mock/manager.ts","../../src/server/storage/database.ts","../../src/server/mock/version-manager.ts","../../src/server/import-export/importer.ts","../../src/server/routes/index.ts","../../src/server/websocket/index.ts","../../src/server/llm/claude-client.ts","../../src/server/llm/prompt-builder.ts","../../src/server/llm/response-parser.ts"],"sourcesContent":["import express from 'express'\r\nimport cors from 'cors'\r\nimport { createServer } from 'http'\r\nimport { WebSocketServer } from 'ws'\r\nimport { MockManager } from './mock/manager.js'\r\nimport { Database } from './storage/database.js'\r\nimport { setupRoutes } from './routes/index.js'\r\nimport { setupWebSocket } from './websocket/index.js'\r\nimport { ClaudeClient, getClaudeClient } from './llm/claude-client.js'\r\nimport pc from 'picocolors'\r\nimport fs from 'fs'\r\n\r\nexport interface ServerConfig {\r\n  port: number\r\n  webPort: number\r\n  backendUrl?: string\r\n  dbPath?: string\r\n  claudeApiKey?: string\r\n}\r\n\r\nfunction loadConfig(): ServerConfig {\r\n  const configPath = './data/config.json'\r\n  let envConfig: any = {}\r\n\r\n  // Try to load from config file\r\n  if (fs.existsSync(configPath)) {\r\n    try {\r\n      envConfig = JSON.parse(fs.readFileSync(configPath, 'utf-8'))\r\n    } catch (e) {\r\n      // Ignore\r\n    }\r\n  }\r\n\r\n  return {\r\n    port: parseInt(process.env.PORT || envConfig.port || '3001'),\r\n    webPort: parseInt(process.env.WEB_PORT || envConfig.webPort || '3000'),\r\n    backendUrl: process.env.BACKEND_URL || envConfig.backendUrl,\r\n    dbPath: process.env.DB_PATH || envConfig.dbPath || './data/mocks.db',\r\n    claudeApiKey: process.env.ANTHROPIC_API_KEY || envConfig.claudeApiKey,\r\n  }\r\n}\r\n\r\nexport class MockServer {\r\n  private app: express.Application\r\n  private server: ReturnType<typeof createServer>\r\n  private wss: WebSocketServer\r\n  private mockManager: MockManager\r\n  private database: Database\r\n  private claudeClient: ClaudeClient\r\n  private config: ServerConfig\r\n\r\n  constructor(config: Partial<ServerConfig> = {}) {\r\n    const loadedConfig = loadConfig()\r\n    this.config = {\r\n      ...loadedConfig,\r\n      ...config,\r\n    }\r\n\r\n    this.app = express()\r\n    this.server = createServer(this.app)\r\n    this.wss = new WebSocketServer({ server: this.server, path: '/ws' })\r\n    this.database = new Database(this.config.dbPath!)\r\n    this.mockManager = new MockManager(this.database)\r\n    this.claudeClient = getClaudeClient({\r\n      apiKey: this.config.claudeApiKey,\r\n    })\r\n\r\n    this.setupMiddleware()\r\n    this.setupRoutes()\r\n    this.setupWebSocket()\r\n  }\r\n\r\n  private setupMiddleware() {\r\n    this.app.use(cors())\r\n    this.app.use(express.json({ limit: '10mb' }))\r\n    this.app.use(express.urlencoded({ extended: true }))\r\n\r\n    // Request logging middleware\r\n    this.app.use((req, res, next) => {\r\n      const start = Date.now()\r\n      res.on('finish', () => {\r\n        const duration = Date.now() - start\r\n        console.log(\r\n          `${pc.gray(new Date().toISOString())} ${pc.blue(req.method)} ${req.path} ${pc.yellow(res.statusCode.toString())} ${pc.gray(duration + 'ms')}`\r\n        )\r\n\r\n        // Broadcast to WebSocket clients\r\n        this.broadcast({\r\n          type: 'REQUEST',\r\n          data: {\r\n            method: req.method,\r\n            path: req.path,\r\n            status: res.statusCode,\r\n            duration,\r\n            timestamp: new Date().toISOString(),\r\n          },\r\n        })\r\n      })\r\n      next()\r\n    })\r\n  }\r\n\r\n  private setupRoutes() {\r\n    setupRoutes(this.app, this.mockManager, this.database, this.config, this.claudeClient)\r\n  }\r\n\r\n  private setupWebSocket() {\r\n    setupWebSocket(this.wss, this.mockManager, this.database)\r\n  }\r\n\r\n  private broadcast(data: any) {\r\n    const message = JSON.stringify(data)\r\n    this.wss.clients.forEach((client) => {\r\n      if (client.readyState === 1) {\r\n        // WebSocket.OPEN\r\n        client.send(message)\r\n      }\r\n    })\r\n  }\r\n\r\n  async start() {\r\n    try {\r\n      // Initialize database\r\n      await this.database.connect()\r\n      console.log(pc.green('[Database] Connected'))\r\n\r\n      // Initialize Claude AI\r\n      await this.claudeClient.initialize()\r\n\r\n      // Start server\r\n      return new Promise<void>((resolve) => {\r\n        this.server.listen(this.config.port, () => {\r\n          console.log(`\r\n${pc.cyan('╔═══════════════════════════════════════════════════════════╗')}\r\n${pc.cyan('║')}     ${pc.bold(pc.blue('MSW Auto Server'))}                          ${pc.cyan('║')}\r\n${pc.cyan('╚═══════════════════════════════════════════════════════════╝')}\r\n${pc.dim('━'.repeat(62))}\r\n\r\n${pc.green('[Server]')} Mock server running on ${pc.bold(`http://localhost:${this.config.port}`)}\r\n${pc.green('[WebUI]')} Web UI available at ${pc.bold(`http://localhost:${this.config.webPort}`)}\r\n${pc.cyan('[WebSocket]')} WS available at ${pc.bold(`ws://localhost:${this.config.port}/ws`)}\r\n\r\n${pc.yellow('Press Ctrl+C to stop the server')}\r\n`)\r\n          resolve()\r\n        })\r\n      })\r\n    } catch (error) {\r\n      console.error(pc.red('[Error] Failed to start server:'), error)\r\n      process.exit(1)\r\n    }\r\n  }\r\n\r\n  stop() {\r\n    this.server.close()\r\n    this.database.close()\r\n    console.log(pc.yellow('[Server] Stopped'))\r\n  }\r\n}\r\n\r\n// Run if called directly\r\nif (import.meta.url === `file://${process.argv[1]}`) {\r\n  const server = new MockServer()\r\n\r\n  server.start()\r\n\r\n  process.on('SIGINT', () => {\r\n    server.stop()\r\n    process.exit(0)\r\n  })\r\n}\r\n","import type { Database } from '../storage/database.js'\r\nimport { v4 as uuidv4 } from 'crypto'\r\n\r\nexport interface Mock {\r\n  id: string\r\n  name: string\r\n  method: string\r\n  path: string\r\n  status: number\r\n  response: any\r\n  headers?: Record<string, string>\r\n  cookies?: Record<string, string>\r\n  delay?: number\r\n  enabled: boolean\r\n  description?: string\r\n  tags?: string[]\r\n  version: number\r\n  created_at: string\r\n  updated_at: string\r\n}\r\n\r\nexport interface CreateMockDto {\r\n  name: string\r\n  method: string\r\n  path: string\r\n  status?: number\r\n  response: any\r\n  headers?: Record<string, string>\r\n  cookies?: Record<string, string>\r\n  delay?: number\r\n  enabled?: boolean\r\n  description?: string\r\n  tags?: string[]\r\n}\r\n\r\nexport class MockManager {\r\n  private mocks: Map<string, Mock> = new Map()\r\n\r\n  constructor(private database: Database) {\r\n    this.loadMocks()\r\n  }\r\n\r\n  private async loadMocks() {\r\n    try {\r\n      const mocks = await this.database.getAllMocks()\r\n      mocks.forEach((mock) => {\r\n        this.mocks.set(mock.id, mock)\r\n      })\r\n    } catch (error) {\r\n      console.log('[MockManager] Using in-memory storage')\r\n    }\r\n  }\r\n\r\n  async create(dto: CreateMockDto): Promise<Mock> {\r\n    const mock: Mock = {\r\n      id: `mock_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\r\n      name: dto.name,\r\n      method: dto.method.toUpperCase(),\r\n      path: dto.path,\r\n      status: dto.status || 200,\r\n      response: dto.response,\r\n      headers: dto.headers,\r\n      cookies: dto.cookies,\r\n      delay: dto.delay || 0,\r\n      enabled: dto.enabled !== false,\r\n      description: dto.description,\r\n      tags: dto.tags,\r\n      version: 1,\r\n      created_at: new Date().toISOString(),\r\n      updated_at: new Date().toISOString(),\r\n    }\r\n\r\n    this.mocks.set(mock.id, mock)\r\n\r\n    try {\r\n      await this.database.saveMock(mock)\r\n    } catch (error) {\r\n      // Continue with in-memory storage\r\n    }\r\n\r\n    return mock\r\n  }\r\n\r\n  async update(id: string, updates: Partial<CreateMockDto>): Promise<Mock | null> {\r\n    const existing = this.mocks.get(id)\r\n    if (!existing) return null\r\n\r\n    const updated: Mock = {\r\n      ...existing,\r\n      ...updates,\r\n      method: updates.method?.toUpperCase() || existing.method,\r\n      status: updates.status || existing.status,\r\n      delay: updates.delay ?? existing.delay,\r\n      enabled: updates.enabled ?? existing.enabled,\r\n      updated_at: new Date().toISOString(),\r\n      version: existing.version + 1,\r\n    }\r\n\r\n    this.mocks.set(id, updated)\r\n\r\n    try {\r\n      await this.database.updateMock(updated)\r\n    } catch (error) {\r\n      // Continue with in-memory storage\r\n    }\r\n\r\n    return updated\r\n  }\r\n\r\n  async delete(id: string): Promise<boolean> {\r\n    const existed = this.mocks.delete(id)\r\n\r\n    if (existed) {\r\n      try {\r\n        await this.database.deleteMock(id)\r\n      } catch (error) {\r\n        // Continue with in-memory storage\r\n      }\r\n    }\r\n\r\n    return existed\r\n  }\r\n\r\n  async findById(id: string): Promise<Mock | null> {\r\n    return this.mocks.get(id) || null\r\n  }\r\n\r\n  async findAll(): Promise<Mock[]> {\r\n    return Array.from(this.mocks.values())\r\n  }\r\n\r\n  async findEnabled(): Promise<Mock[]> {\r\n    return Array.from(this.mocks.values()).filter((mock) => mock.enabled)\r\n  }\r\n\r\n  findMatchingMock(method: string, path: string): Mock | null {\r\n    const enabledMocks = Array.from(this.mocks.values()).filter((mock) => mock.enabled)\r\n\r\n    for (const mock of enabledMocks) {\r\n      if (this.isMatch(method, path, mock)) {\r\n        return mock\r\n      }\r\n    }\r\n\r\n    return null\r\n  }\r\n\r\n  private isMatch(method: string, path: string, mock: Mock): boolean {\r\n    // Method check\r\n    if (mock.method !== '*' && mock.method !== method.toUpperCase()) {\r\n      return false\r\n    }\r\n\r\n    // Path matching with parameter support\r\n    const mockPathParts = mock.path.split('/')\r\n    const reqPathParts = path.split('?')[0].split('/')\r\n\r\n    if (mockPathParts.length !== reqPathParts.length) {\r\n      return false\r\n    }\r\n\r\n    for (let i = 0; i < mockPathParts.length; i++) {\r\n      const mockPart = mockPathParts[i]\r\n      const reqPart = reqPathParts[i]\r\n\r\n      // Skip empty parts\r\n      if (!mockPart && !reqPart) continue\r\n\r\n      // Parameter matching (:id, :userId, etc.)\r\n      if (mockPart.startsWith(':')) {\r\n        continue\r\n      }\r\n\r\n      // Wildcard matching\r\n      if (mockPart === '*') {\r\n        continue\r\n      }\r\n\r\n      // Exact matching\r\n      if (mockPart !== reqPart) {\r\n        return false\r\n      }\r\n    }\r\n\r\n    return true\r\n  }\r\n\r\n  async toggle(id: string): Promise<Mock | null> {\r\n    const mock = this.mocks.get(id)\r\n    if (!mock) return null\r\n\r\n    return this.update(id, { enabled: !mock.enabled })\r\n  }\r\n\r\n  async duplicate(id: string): Promise<Mock | null> {\r\n    const original = this.mocks.get(id)\r\n    if (!original) return null\r\n\r\n    return this.create({\r\n      name: `${original.name} (copy)`,\r\n      method: original.method,\r\n      path: original.path,\r\n      status: original.status,\r\n      response: original.response,\r\n      headers: original.headers,\r\n      cookies: original.cookies,\r\n      delay: original.delay,\r\n      enabled: false,\r\n      description: original.description,\r\n      tags: original.tags,\r\n    })\r\n  }\r\n}\r\n","import Database from 'better-sqlite3'\r\nimport fs from 'fs'\r\nimport path from 'path'\r\nimport type { Mock } from '../mock/manager.js'\r\nimport type { MockVersion } from '../mock/version-manager.js'\r\n\r\nexport class Database {\r\n  private db: Database.Database | null = null\r\n  private dbPath: string\r\n\r\n  constructor(dbPath: string) {\r\n    this.dbPath = dbPath\r\n  }\r\n\r\n  async connect(): Promise<void> {\r\n    const dir = path.dirname(this.dbPath)\r\n    if (!fs.existsSync(dir)) {\r\n      fs.mkdirSync(dir, { recursive: true })\r\n    }\r\n\r\n    this.db = new Database(this.dbPath)\r\n    this.db.pragma('journal_mode = WAL')\r\n    this.initSchema()\r\n  }\r\n\r\n  private initSchema(): void {\r\n    this.db!.exec(`\r\n      CREATE TABLE IF NOT EXISTS mocks (\r\n        id TEXT PRIMARY KEY,\r\n        name TEXT NOT NULL,\r\n        method TEXT NOT NULL,\r\n        path TEXT NOT NULL,\r\n        status INTEGER DEFAULT 200,\r\n        response TEXT NOT NULL,\r\n        headers TEXT,\r\n        cookies TEXT,\r\n        delay INTEGER DEFAULT 0,\r\n        enabled INTEGER DEFAULT 1,\r\n        description TEXT,\r\n        tags TEXT,\r\n        version INTEGER DEFAULT 1,\r\n        created_at TEXT NOT NULL,\r\n        updated_at TEXT NOT NULL\r\n      );\r\n\r\n      CREATE TABLE IF NOT EXISTS request_logs (\r\n        id TEXT PRIMARY KEY,\r\n        method TEXT NOT NULL,\r\n        path TEXT NOT NULL,\r\n        query TEXT,\r\n        headers TEXT,\r\n        body TEXT,\r\n        response_status INTEGER,\r\n        response_body TEXT,\r\n        response_time INTEGER,\r\n        is_mocked INTEGER DEFAULT 0,\r\n        mock_id TEXT,\r\n        timestamp TEXT NOT NULL\r\n      );\r\n\r\n      CREATE TABLE IF NOT EXISTS mock_versions (\r\n        id TEXT PRIMARY KEY,\r\n        mock_id TEXT NOT NULL,\r\n        version INTEGER NOT NULL,\r\n        response TEXT NOT NULL,\r\n        headers TEXT,\r\n        description TEXT,\r\n        created_at TEXT NOT NULL\r\n      );\r\n\r\n      CREATE INDEX IF NOT EXISTS idx_mocks_method_path ON mocks(method, path);\r\n      CREATE INDEX IF NOT EXISTS idx_mocks_enabled ON mocks(enabled);\r\n      CREATE INDEX IF NOT EXISTS idx_request_logs_timestamp ON request_logs(timestamp DESC);\r\n      CREATE INDEX IF NOT EXISTS idx_mock_versions_mock_id ON mock_versions(mock_id, version DESC);\r\n    `)\r\n  }\r\n\r\n  // ============ Mock Operations ============\r\n\r\n  async getAllMocks(): Promise<Mock[]> {\r\n    const rows = this.db!.prepare('SELECT * FROM mocks ORDER BY created_at DESC').all() as any[]\r\n    return rows.map(this.mapRowToMock)\r\n  }\r\n\r\n  async getMockById(id: string): Promise<Mock | null> {\r\n    const row = this.db!.prepare('SELECT * FROM mocks WHERE id = ?').get(id) as any\r\n    return row ? this.mapRowToMock(row) : null\r\n  }\r\n\r\n  async saveMock(mock: Mock): Promise<void> {\r\n    const stmt = this.db!.prepare(`\r\n      INSERT INTO mocks (id, name, method, path, status, response, headers, cookies, delay, enabled, description, tags, version, created_at, updated_at)\r\n      VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\r\n    `)\r\n\r\n    stmt.run(\r\n      mock.id,\r\n      mock.name,\r\n      mock.method,\r\n      mock.path,\r\n      mock.status,\r\n      JSON.stringify(mock.response),\r\n      mock.headers ? JSON.stringify(mock.headers) : null,\r\n      mock.cookies ? JSON.stringify(mock.cookies) : null,\r\n      mock.delay || 0,\r\n      mock.enabled ? 1 : 0,\r\n      mock.description || null,\r\n      mock.tags ? mock.tags.join(',') : null,\r\n      mock.version,\r\n      mock.created_at,\r\n      mock.updated_at\r\n    )\r\n  }\r\n\r\n  async updateMock(mock: Mock): Promise<void> {\r\n    const stmt = this.db!.prepare(`\r\n      UPDATE mocks SET\r\n        name = ?, method = ?, path = ?, status = ?, response = ?,\r\n        headers = ?, cookies = ?, delay = ?, enabled = ?,\r\n        description = ?, tags = ?, version = ?, updated_at = ?\r\n      WHERE id = ?\r\n    `)\r\n\r\n    stmt.run(\r\n      mock.name,\r\n      mock.method,\r\n      mock.path,\r\n      mock.status,\r\n      JSON.stringify(mock.response),\r\n      mock.headers ? JSON.stringify(mock.headers) : null,\r\n      mock.cookies ? JSON.stringify(mock.cookies) : null,\r\n      mock.delay || 0,\r\n      mock.enabled ? 1 : 0,\r\n      mock.description || null,\r\n      mock.tags ? mock.tags.join(',') : null,\r\n      mock.version,\r\n      mock.updated_at,\r\n      mock.id\r\n    )\r\n  }\r\n\r\n  async deleteMock(id: string): Promise<void> {\r\n    // Also delete versions\r\n    this.db!.prepare('DELETE FROM mock_versions WHERE mock_id = ?').run(id)\r\n    this.db!.prepare('DELETE FROM mocks WHERE id = ?').run(id)\r\n  }\r\n\r\n  // ============ Version Operations ============\r\n\r\n  async saveMockVersion(version: MockVersion): Promise<void> {\r\n    const stmt = this.db!.prepare(`\r\n      INSERT INTO mock_versions (id, mock_id, version, response, headers, description, created_at)\r\n      VALUES (?, ?, ?, ?, ?, ?, ?)\r\n    `)\r\n\r\n    stmt.run(\r\n      version.id,\r\n      version.mock_id,\r\n      version.version,\r\n      JSON.stringify(version.response),\r\n      version.headers ? JSON.stringify(version.headers) : null,\r\n      version.description || null,\r\n      version.created_at\r\n    )\r\n  }\r\n\r\n  async getMockVersions(mockId: string): Promise<MockVersion[]> {\r\n    const rows = this.db!.prepare('SELECT * FROM mock_versions WHERE mock_id = ? ORDER BY version DESC').all(mockId) as any[]\r\n    return rows.map((row) => ({\r\n      id: row.id,\r\n      mock_id: row.mock_id,\r\n      version: row.version,\r\n      response: JSON.parse(row.response),\r\n      headers: row.headers ? JSON.parse(row.headers) : undefined,\r\n      description: row.description,\r\n      created_at: row.created_at,\r\n    }))\r\n  }\r\n\r\n  async getMockVersion(mockId: string, version: number): Promise<MockVersion | null> {\r\n    const row = this.db!.prepare('SELECT * FROM mock_versions WHERE mock_id = ? AND version = ?').get(mockId, version) as any\r\n    if (!row) return null\r\n\r\n    return {\r\n      id: row.id,\r\n      mock_id: row.mock_id,\r\n      version: row.version,\r\n      response: JSON.parse(row.response),\r\n      headers: row.headers ? JSON.parse(row.headers) : undefined,\r\n      description: row.description,\r\n      created_at: row.created_at,\r\n    }\r\n  }\r\n\r\n  async deleteMockVersion(id: string): Promise<void> {\r\n    this.db!.prepare('DELETE FROM mock_versions WHERE id = ?').run(id)\r\n  }\r\n\r\n  // ============ Request Log Operations ============\r\n\r\n  async saveRequestLog(log: any): Promise<void> {\r\n    const stmt = this.db!.prepare(`\r\n      INSERT INTO request_logs (id, method, path, query, headers, body, response_status, response_body, response_time, is_mocked, mock_id, timestamp)\r\n      VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\r\n    `)\r\n\r\n    stmt.run(\r\n      log.id,\r\n      log.method,\r\n      log.path,\r\n      log.query ? JSON.stringify(log.query) : null,\r\n      log.headers ? JSON.stringify(log.headers) : null,\r\n      log.body ? JSON.stringify(log.body) : null,\r\n      log.response_status,\r\n      log.response_body ? JSON.stringify(log.response_body) : null,\r\n      log.response_time,\r\n      log.is_mocked ? 1 : 0,\r\n      log.mock_id || null,\r\n      log.timestamp\r\n    )\r\n  }\r\n\r\n  async getRecentRequests(limit = 100): Promise<any[]> {\r\n    const rows = this.db!.prepare('SELECT * FROM request_logs ORDER BY timestamp DESC LIMIT ?').all(limit) as any[]\r\n    return rows.map((row) => ({\r\n      ...row,\r\n      headers: row.headers ? JSON.parse(row.headers) : null,\r\n      query: row.query ? JSON.parse(row.query) : null,\r\n      body: row.body ? JSON.parse(row.body) : null,\r\n      response_body: row.response_body ? JSON.parse(row.response_body) : null,\r\n      is_mocked: row.is_mocked === 1,\r\n    }))\r\n  }\r\n\r\n  // ============ Helpers ============\r\n\r\n  private mapRowToMock(row: any): Mock {\r\n    return {\r\n      id: row.id,\r\n      name: row.name,\r\n      method: row.method,\r\n      path: row.path,\r\n      status: row.status,\r\n      response: JSON.parse(row.response),\r\n      headers: row.headers ? JSON.parse(row.headers) : undefined,\r\n      cookies: row.cookies ? JSON.parse(row.cookies) : undefined,\r\n      delay: row.delay,\r\n      enabled: row.enabled === 1,\r\n      description: row.description,\r\n      tags: row.tags ? row.tags.split(',') : [],\r\n      version: row.version,\r\n      created_at: row.created_at,\r\n      updated_at: row.updated_at,\r\n    }\r\n  }\r\n\r\n  close(): void {\r\n    this.db?.close()\r\n  }\r\n}\r\n\r\nexport default Database\r\n","import type { Database } from '../storage/database.js'\r\n\r\nexport interface MockVersion {\r\n  id: string\r\n  mock_id: string\r\n  version: number\r\n  response: any\r\n  headers?: Record<string, string>\r\n  description?: string\r\n  created_at: string\r\n}\r\n\r\nexport class VersionManager {\r\n  private database: Database\r\n  private maxVersions: number = 10\r\n\r\n  constructor(database: Database) {\r\n    this.database = database\r\n  }\r\n\r\n  async createVersion(mockId: string, response: any, headers?: Record<string, string>, description?: string): Promise<MockVersion> {\r\n    // Get current version number\r\n    const versions = await this.database.getMockVersions(mockId)\r\n    const versionNumber = versions.length > 0 ? Math.max(...versions.map(v => v.version)) + 1 : 1\r\n\r\n    const version: MockVersion = {\r\n      id: `ver_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\r\n      mock_id: mockId,\r\n      version: versionNumber,\r\n      response,\r\n      headers,\r\n      description,\r\n      created_at: new Date().toISOString(),\r\n    }\r\n\r\n    await this.database.saveMockVersion(version)\r\n\r\n    // Cleanup old versions\r\n    await this.cleanupVersions(mockId)\r\n\r\n    return version\r\n  }\r\n\r\n  async getVersions(mockId: string): Promise<MockVersion[]> {\r\n    return this.database.getMockVersions(mockId)\r\n  }\r\n\r\n  async getVersion(mockId: string, version: number): Promise<MockVersion | null> {\r\n    return this.database.getMockVersion(mockId, version)\r\n  }\r\n\r\n  async rollback(mockId: string, targetVersion: number): Promise<MockVersion | null> {\r\n    const version = await this.getVersion(mockId, targetVersion)\r\n    if (!version) {\r\n      return null\r\n    }\r\n\r\n    // Create a new version for the rollback\r\n    return this.createVersion(mockId, version.response, version.headers, `Rolled back to version ${targetVersion}`)\r\n  }\r\n\r\n  private async cleanupVersions(mockId: string): Promise<void> {\r\n    const versions = await this.database.getMockVersions(mockId)\r\n\r\n    if (versions.length > this.maxVersions) {\r\n      // Sort by version descending\r\n      versions.sort((a, b) => b.version - a.version)\r\n\r\n      // Delete oldest versions\r\n      const toDelete = versions.slice(this.maxVersions)\r\n      for (const version of toDelete) {\r\n        await this.database.deleteMockVersion(version.id)\r\n      }\r\n    }\r\n  }\r\n\r\n  async compareVersions(mockId: string, version1: number, version2: number): Promise<{\r\n    v1: MockVersion | null\r\n    v2: MockVersion | null\r\n    differences: string[]\r\n  }> {\r\n    const v1 = await this.getVersion(mockId, version1)\r\n    const v2 = await this.getVersion(mockId, version2)\r\n\r\n    const differences: string[] = []\r\n\r\n    if (v1 && v2) {\r\n      // Compare responses\r\n      if (JSON.stringify(v1.response) !== JSON.stringify(v2.response)) {\r\n        differences.push('Response body changed')\r\n      }\r\n\r\n      if (JSON.stringify(v1.headers) !== JSON.stringify(v2.headers)) {\r\n        differences.push('Headers changed')\r\n      }\r\n    }\r\n\r\n    return { v1, v2, differences }\r\n  }\r\n}\r\n","import type { Mock, CreateMockDto } from '../mock/manager.js'\r\nimport pc from 'picocolors'\r\n\r\nexport interface OpenAPISpec {\r\n  openapi?: string\r\n  swagger?: string\r\n  info: {\r\n    title: string\r\n    version: string\r\n    description?: string\r\n  }\r\n  paths: Record<string, PathItem>\r\n  components?: {\r\n    schemas?: Record<string, any>\r\n  }\r\n}\r\n\r\nexport interface PathItem {\r\n  get?: Operation\r\n  post?: Operation\r\n  put?: Operation\r\n  delete?: Operation\r\n  patch?: Operation\r\n  options?: Operation\r\n  head?: Operation\r\n}\r\n\r\nexport interface Operation {\r\n  summary?: string\r\n  description?: string\r\n  operationId?: string\r\n  parameters?: Parameter[]\r\n  requestBody?: RequestBody\r\n  responses?: Record<string, Response>\r\n  tags?: string[]\r\n}\r\n\r\nexport interface Parameter {\r\n  name: string\r\n  in: 'path' | 'query' | 'header' | 'cookie'\r\n  required?: boolean\r\n  schema?: any\r\n  description?: string\r\n}\r\n\r\nexport interface RequestBody {\r\n  content?: Record<string, MediaType>\r\n  required?: boolean\r\n}\r\n\r\nexport interface MediaType {\r\n  schema?: any\r\n  example?: any\r\n}\r\n\r\nexport interface Response {\r\n  description?: string\r\n  content?: Record<string, MediaType>\r\n}\r\n\r\nexport interface PostmanCollection {\r\n  info: {\r\n    name: string\r\n    description?: string\r\n    schema: string\r\n  }\r\n  item: PostmanItem[]\r\n}\r\n\r\nexport interface PostmanItem {\r\n  name: string\r\n  request?: PostmanRequest\r\n  item?: PostmanItem[]\r\n}\r\n\r\nexport interface PostmanRequest {\r\n  method: string\r\n  url: string | PostmanUrl\r\n  header?: PostmanHeader[]\r\n  body?: PostmanBody\r\n}\r\n\r\nexport interface PostmanUrl {\r\n  raw: string\r\n  path?: string[]\r\n  query?: { key: string; value: string }[]\r\n}\r\n\r\nexport interface PostmanHeader {\r\n  key: string\r\n  value: string\r\n}\r\n\r\nexport interface PostmanBody {\r\n  mode?: 'raw' | 'formdata' | 'urlencoded'\r\n  raw?: string\r\n  json?: any\r\n}\r\n\r\nexport class ImportExporter {\r\n  /**\r\n   * Import from OpenAPI/Swagger specification\r\n   */\r\n  async fromOpenAPI(spec: OpenAPISpec): Promise<Partial<Mock>[]> {\r\n    const mocks: Partial<Mock>[] = []\r\n\r\n    console.log(pc.cyan('[Import] Processing OpenAPI specification...'))\r\n\r\n    for (const [path, pathItem] of Object.entries(spec.paths)) {\r\n      const methods = ['get', 'post', 'put', 'delete', 'patch', 'options', 'head'] as const\r\n\r\n      for (const method of methods) {\r\n        const operation = pathItem[method]\r\n        if (!operation) continue\r\n\r\n        const mock = this.convertOpenAPIToMock(method.toUpperCase(), path, operation, spec)\r\n        mocks.push(mock)\r\n      }\r\n    }\r\n\r\n    console.log(pc.green(`[Import] Generated ${mocks.length} mocks from OpenAPI`))\r\n    return mocks\r\n  }\r\n\r\n  /**\r\n   * Import from Postman collection\r\n   */\r\n  async fromPostman(collection: PostmanCollection): Promise<Partial<Mock>[]> {\r\n    const mocks: Partial<Mock>[] = []\r\n\r\n    console.log(pc.cyan('[Import] Processing Postman collection...'))\r\n\r\n    const processItems = (items: PostmanItem[], basePath = '') => {\r\n      for (const item of items) {\r\n        if (item.item) {\r\n          // Folder - recurse\r\n          processItems(item.item, basePath)\r\n        } else if (item.request) {\r\n          // Request\r\n          const mock = this.convertPostmanToMock(item, basePath)\r\n          if (mock) {\r\n            mocks.push(mock)\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    processItems(collection.item)\r\n\r\n    console.log(pc.green(`[Import] Generated ${mocks.length} mocks from Postman`))\r\n    return mocks\r\n  }\r\n\r\n  /**\r\n   * Export to OpenAPI specification\r\n   */\r\n  toOpenAPI(mocks: Mock[]): OpenAPISpec {\r\n    const paths: Record<string, PathItem> = {}\r\n\r\n    for (const mock of mocks) {\r\n      const method = mock.method.toLowerCase() as keyof PathItem\r\n      if (!paths[mock.path]) {\r\n        paths[mock.path] = {}\r\n      }\r\n\r\n      paths[mock.path][method] = {\r\n        summary: mock.name,\r\n        description: mock.description,\r\n        tags: mock.tags,\r\n        responses: {\r\n          [mock.status.toString()]: {\r\n            description: 'Successful response',\r\n            content: {\r\n              'application/json': {\r\n                schema: {\r\n                  type: 'object',\r\n                },\r\n                example: mock.response,\r\n              },\r\n            },\r\n          },\r\n        },\r\n      }\r\n    }\r\n\r\n    return {\r\n      openapi: '3.0.0',\r\n      info: {\r\n        title: 'MSW Auto Export',\r\n        version: '1.0.0',\r\n        description: 'Generated from MSW Auto mocks',\r\n      },\r\n      paths,\r\n      components: {\r\n        schemas: {},\r\n      },\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Export to Postman collection\r\n   */\r\n  toPostman(mocks: Mock[]): PostmanCollection {\r\n    const items: PostmanItem[] = mocks.map((mock) => ({\r\n      name: mock.name,\r\n      request: {\r\n        method: mock.method,\r\n        url: {\r\n          raw: mock.path,\r\n          path: mock.path.split('/').filter(Boolean),\r\n        },\r\n        header: mock.headers\r\n          ? Object.entries(mock.headers).map(([key, value]) => ({ key, value }))\r\n          : [],\r\n        body: {\r\n          mode: 'raw',\r\n          raw: JSON.stringify(mock.response, null, 2),\r\n        },\r\n      },\r\n    }))\r\n\r\n    return {\r\n      info: {\r\n        name: 'MSW Auto Export',\r\n        description: 'Generated from MSW Auto mocks',\r\n        schema: 'https://schema.getpostman.com/json/collection/v2.1.0/collection.json',\r\n      },\r\n      item: items,\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Export to JSON file\r\n   */\r\n  toJSON(mocks: Mock[]): string {\r\n    return JSON.stringify(mocks, null, 2)\r\n  }\r\n\r\n  // ============ Private Helpers ============\r\n\r\n  private convertOpenAPIToMock(\r\n    method: string,\r\n    path: string,\r\n    operation: Operation,\r\n    spec: OpenAPISpec\r\n  ): Partial<Mock> {\r\n    // Generate mock response from schema\r\n    const response = this.generateMockResponse(operation, spec)\r\n\r\n    // Extract status code\r\n    const statusCode = this.extractStatusCode(operation.responses)\r\n\r\n    return {\r\n      name: operation.summary || operation.operationId || `${method} ${path}`,\r\n      method,\r\n      path: this.convertPathParams(path),\r\n      status: statusCode,\r\n      response,\r\n      description: operation.description || operation.summary,\r\n      tags: operation.tags,\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n      },\r\n      enabled: true,\r\n    }\r\n  }\r\n\r\n  private convertPostmanToMock(item: PostmanItem, basePath: string): Partial<Mock> | null {\r\n    if (!item.request) return null\r\n\r\n    const method = item.request.method\r\n    let url = ''\r\n\r\n    if (typeof item.request.url === 'string') {\r\n      url = item.request.url\r\n    } else if (item.request.url?.raw) {\r\n      url = item.request.url.raw\r\n    }\r\n\r\n    // Combine base path\r\n    const fullPath = basePath ? `${basePath}/${url}`.replace(/\\/+/g, '/') : url\r\n\r\n    let response = { message: 'Mock response' }\r\n\r\n    // Try to parse body\r\n    if (item.request.body?.raw) {\r\n      try {\r\n        response = JSON.parse(item.request.body.raw)\r\n      } catch {\r\n        // Keep default\r\n      }\r\n    }\r\n\r\n    return {\r\n      name: item.name,\r\n      method,\r\n      path: fullPath,\r\n      status: 200,\r\n      response,\r\n      description: item.name,\r\n      enabled: true,\r\n    }\r\n  }\r\n\r\n  private convertPathParams(path: string): string {\r\n    // Convert {id} to :id for MSW compatibility\r\n    return path.replace(/\\{(\\w+)\\}/g, ':$1')\r\n  }\r\n\r\n  private generateMockResponse(operation: Operation, spec: OpenAPISpec): any {\r\n    // Look for successful response (2xx)\r\n    const successResponse = operation.responses?.['200'] ||\r\n      operation.responses?.['201'] ||\r\n      operation.responses?.['default']\r\n\r\n    if (!successResponse?.content?.['application/json']?.example) {\r\n      // Try to generate from schema\r\n      const schema = successResponse?.content?.['application/json']?.schema\r\n      if (schema) {\r\n        return this.generateFromSchema(schema, spec.components?.schemas || {})\r\n      }\r\n      return { message: 'Mock response' }\r\n    }\r\n\r\n    return successResponse.content['application/json'].example\r\n  }\r\n\r\n  private generateFromSchema(schema: any, definitions: Record<string, any>): any {\r\n    if (!schema) return null\r\n\r\n    // Handle $ref\r\n    if (schema.$ref) {\r\n      const refName = schema.$ref.split('/').pop()\r\n      if (refName && definitions[refName]) {\r\n        return this.generateFromSchema(definitions[refName], definitions)\r\n      }\r\n    }\r\n\r\n    // Handle type\r\n    switch (schema.type) {\r\n      case 'object':\r\n        if (schema.properties) {\r\n          const obj: Record<string, any> = {}\r\n          for (const [key, prop] of Object.entries(schema.properties)) {\r\n            obj[key] = this.generateFromSchema(prop, definitions)\r\n          }\r\n          return obj\r\n        }\r\n        return {}\r\n\r\n      case 'array':\r\n        if (schema.items) {\r\n          return [this.generateFromSchema(schema.items, definitions)]\r\n        }\r\n        return []\r\n\r\n      case 'string':\r\n        if (schema.enum) return schema.enum[0]\r\n        if (schema.format === 'date-time') return new Date().toISOString()\r\n        if (schema.format === 'date') return new Date().toISOString().split('T')[0]\r\n        if (schema.format === 'email') return 'user@example.com'\r\n        if (schema.format === 'uri') return 'https://example.com'\r\n        return 'string'\r\n\r\n      case 'integer':\r\n      case 'number':\r\n        return schema.minimum || 0\r\n\r\n      case 'boolean':\r\n        return true\r\n\r\n      default:\r\n        return null\r\n    }\r\n  }\r\n\r\n  private extractStatusCode(responses: Record<string, Response> | undefined): number {\r\n    if (!responses) return 200\r\n\r\n    // Try 2xx first\r\n    if (responses['200']) return 200\r\n    if (responses['201']) return 201\r\n    if (responses['202']) return 202\r\n\r\n    // Default to first available\r\n    const codes = Object.keys(responses)\r\n    if (codes.length > 0) {\r\n      return parseInt(codes[0]) || 200\r\n    }\r\n\r\n    return 200\r\n  }\r\n}\r\n","import express from 'express'\r\nimport type { MockManager } from '../mock/manager.js'\r\nimport type { Database } from '../storage/database.js'\r\nimport type { ClaudeClient } from '../llm/claude-client.js'\r\nimport { VersionManager } from '../mock/version-manager.js'\r\nimport { ImportExporter } from '../import-export/importer.js'\r\nimport pc from 'picocolors'\r\n\r\nexport interface ServerConfig {\r\n  port: number\r\n  webPort: number\r\n  backendUrl?: string\r\n  dbPath?: string\r\n  claudeApiKey?: string\r\n}\r\n\r\nexport function setupRoutes(\r\n  app: express.Application,\r\n  mockManager: MockManager,\r\n  database: Database,\r\n  config: ServerConfig,\r\n  claudeClient: ClaudeClient\r\n) {\r\n  const versionManager = new VersionManager(database)\r\n  const importer = new ImportExporter()\r\n\r\n  // Health check\r\n  app.get('/health', (req, res) => {\r\n    res.json({ status: 'ok', timestamp: new Date().toISOString() })\r\n  })\r\n\r\n  // ============ Mock CRUD API ============\r\n  app.get('/api/mocks', async (req, res) => {\r\n    try {\r\n      const mocks = await mockManager.findAll()\r\n      res.json(mocks)\r\n    } catch (error: any) {\r\n      res.status(500).json({ error: error.message })\r\n    }\r\n  })\r\n\r\n  app.get('/api/mocks/:id', async (req, res) => {\r\n    try {\r\n      const mock = await mockManager.findById(req.params.id)\r\n      if (!mock) {\r\n        return res.status(404).json({ error: 'Mock not found' })\r\n      }\r\n      res.json(mock)\r\n    } catch (error: any) {\r\n      res.status(500).json({ error: error.message })\r\n    }\r\n  })\r\n\r\n  app.post('/api/mocks', async (req, res) => {\r\n    try {\r\n      const mock = await mockManager.create(req.body)\r\n      res.status(201).json(mock)\r\n    } catch (error: any) {\r\n      res.status(400).json({ error: error.message })\r\n    }\r\n  })\r\n\r\n  app.put('/api/mocks/:id', async (req, res) => {\r\n    try {\r\n      const mock = await mockManager.update(req.params.id, req.body)\r\n      if (!mock) {\r\n        return res.status(404).json({ error: 'Mock not found' })\r\n      }\r\n      res.json(mock)\r\n    } catch (error: any) {\r\n      res.status(400).json({ error: error.message })\r\n    }\r\n  })\r\n\r\n  app.delete('/api/mocks/:id', async (req, res) => {\r\n    try {\r\n      const deleted = await mockManager.delete(req.params.id)\r\n      if (!deleted) {\r\n        return res.status(404).json({ error: 'Mock not found' })\r\n      }\r\n      res.json({ success: true })\r\n    } catch (error: any) {\r\n      res.status(500).json({ error: error.message })\r\n    }\r\n  })\r\n\r\n  app.post('/api/mocks/:id/toggle', async (req, res) => {\r\n    try {\r\n      const mock = await mockManager.toggle(req.params.id)\r\n      if (!mock) {\r\n        return res.status(404).json({ error: 'Mock not found' })\r\n      }\r\n      res.json(mock)\r\n    } catch (error: any) {\r\n      res.status(500).json({ error: error.message })\r\n    }\r\n  })\r\n\r\n  app.post('/api/mocks/:id/duplicate', async (req, res) => {\r\n    try {\r\n      const mock = await mockManager.duplicate(req.params.id)\r\n      if (!mock) {\r\n        return res.status(404).json({ error: 'Mock not found' })\r\n      }\r\n      res.status(201).json(mock)\r\n    } catch (error: any) {\r\n      res.status(500).json({ error: error.message })\r\n    }\r\n  })\r\n\r\n  // ============ AI Generation API ============\r\n\r\n  // Generate mock using AI\r\n  app.post('/api/ai/generate', async (req, res) => {\r\n    try {\r\n      const { method, path, description, context } = req.body\r\n\r\n      if (!method || !path) {\r\n        return res.status(400).json({ error: 'method and path are required' })\r\n      }\r\n\r\n      const generated = await claudeClient.generateMock({\r\n        method,\r\n        path,\r\n        description,\r\n        context,\r\n      })\r\n\r\n      // Save the generated mock\r\n      const mock = await mockManager.create(generated)\r\n\r\n      res.status(201).json(mock)\r\n    } catch (error: any) {\r\n      res.status(500).json({ error: error.message })\r\n    }\r\n  })\r\n\r\n  // Improve existing mock using AI\r\n  app.post('/api/ai/improve/:id', async (req, res) => {\r\n    try {\r\n      const { instruction } = req.body\r\n\r\n      if (!instruction) {\r\n        return res.status(400).json({ error: 'instruction is required' })\r\n      }\r\n\r\n      const existingMock = await mockManager.findById(req.params.id)\r\n      if (!existingMock) {\r\n        return res.status(404).json({ error: 'Mock not found' })\r\n      }\r\n\r\n      const improved = await claudeClient.improveMock(existingMock, instruction)\r\n\r\n      // Update the mock with improvements\r\n      const updated = await mockManager.update(req.params.id, improved)\r\n\r\n      res.json(updated)\r\n    } catch (error: any) {\r\n      res.status(500).json({ error: error.message })\r\n    }\r\n  })\r\n\r\n  // Generate documentation using AI\r\n  app.post('/api/ai/docs/:id', async (req, res) => {\r\n    try {\r\n      const mock = await mockManager.findById(req.params.id)\r\n      if (!mock) {\r\n        return res.status(404).json({ error: 'Mock not found' })\r\n      }\r\n\r\n      const documentation = await claudeClient.generateDocumentation(mock)\r\n\r\n      res.json({ documentation })\r\n    } catch (error: any) {\r\n      res.status(500).json({ error: error.message })\r\n    }\r\n  })\r\n\r\n  // Chat with AI assistant\r\n  app.post('/api/ai/chat', async (req, res) => {\r\n    try {\r\n      const { messages, context } = req.body\r\n\r\n      if (!messages || !Array.isArray(messages)) {\r\n        return res.status(400).json({ error: 'messages array is required' })\r\n      }\r\n\r\n      const reply = await claudeClient.chat(messages, context)\r\n\r\n      res.json({ reply })\r\n    } catch (error: any) {\r\n      res.status(500).json({ error: error.message })\r\n    }\r\n  })\r\n\r\n  // Check AI status\r\n  app.get('/api/ai/status', (req, res) => {\r\n    res.json({\r\n      enabled: claudeClient.isEnabled(),\r\n      provider: 'Anthropic Claude',\r\n    })\r\n  })\r\n\r\n  // ============ Version Management API ============\r\n\r\n  // Get mock versions\r\n  app.get('/api/mocks/:id/versions', async (req, res) => {\r\n    try {\r\n      const versions = await versionManager.getVersions(req.params.id)\r\n      res.json(versions)\r\n    } catch (error: any) {\r\n      res.status(500).json({ error: error.message })\r\n    }\r\n  })\r\n\r\n  // Get specific version\r\n  app.get('/api/mocks/:id/versions/:version', async (req, res) => {\r\n    try {\r\n      const version = await versionManager.getVersion(req.params.id, parseInt(req.params.version))\r\n      if (!version) {\r\n        return res.status(404).json({ error: 'Version not found' })\r\n      }\r\n      res.json(version)\r\n    } catch (error: any) {\r\n      res.status(500).json({ error: error.message })\r\n    }\r\n  })\r\n\r\n  // Create new version (snapshot)\r\n  app.post('/api/mocks/:id/versions', async (req, res) => {\r\n    try {\r\n      const mock = await mockManager.findById(req.params.id)\r\n      if (!mock) {\r\n        return res.status(404).json({ error: 'Mock not found' })\r\n      }\r\n\r\n      const version = await versionManager.createVersion(\r\n        mock.id,\r\n        mock.response,\r\n        mock.headers,\r\n        req.body.description\r\n      )\r\n\r\n      res.status(201).json(version)\r\n    } catch (error: any) {\r\n      res.status(500).json({ error: error.message })\r\n    }\r\n  })\r\n\r\n  // Rollback to version\r\n  app.post('/api/mocks/:id/versions/:version/rollback', async (req, res) => {\r\n    try {\r\n      const version = await versionManager.rollback(\r\n        req.params.id,\r\n        parseInt(req.params.version)\r\n      )\r\n\r\n      if (!version) {\r\n        return res.status(404).json({ error: 'Version not found' })\r\n      }\r\n\r\n      // Update the mock with the version\r\n      const mock = await mockManager.update(req.params.id, {\r\n        response: version.response,\r\n        headers: version.headers,\r\n      })\r\n\r\n      res.json(mock)\r\n    } catch (error: any) {\r\n      res.status(500).json({ error: error.message })\r\n    }\r\n  })\r\n\r\n  // Compare versions\r\n  app.get('/api/mocks/:id/versions/compare', async (req, res) => {\r\n    try {\r\n      const v1 = parseInt(req.query.v1 as string)\r\n      const v2 = parseInt(req.query.v2 as string)\r\n\r\n      if (!v1 || !v2) {\r\n        return res.status(400).json({ error: 'v1 and v2 query params required' })\r\n      }\r\n\r\n      const comparison = await versionManager.compareVersions(req.params.id, v1, v2)\r\n      res.json(comparison)\r\n    } catch (error: any) {\r\n      res.status(500).json({ error: error.message })\r\n    }\r\n  })\r\n\r\n  // ============ Import/Export API ============\r\n\r\n  // Import from OpenAPI/Swagger\r\n  app.post('/api/import/openapi', async (req, res) => {\r\n    try {\r\n      const spec = req.body\r\n      const mocks = await importer.fromOpenAPI(spec)\r\n\r\n      // Save all mocks\r\n      const created = []\r\n      for (const mockData of mocks) {\r\n        const mock = await mockManager.create(mockData)\r\n        created.push(mock)\r\n      }\r\n\r\n      res.status(201).json({\r\n        imported: created.length,\r\n        mocks: created,\r\n      })\r\n    } catch (error: any) {\r\n      res.status(400).json({ error: error.message })\r\n    }\r\n  })\r\n\r\n  // Import from Postman\r\n  app.post('/api/import/postman', async (req, res) => {\r\n    try {\r\n      const collection = req.body\r\n      const mocks = await importer.fromPostman(collection)\r\n\r\n      // Save all mocks\r\n      const created = []\r\n      for (const mockData of mocks) {\r\n        const mock = await mockManager.create(mockData)\r\n        created.push(mock)\r\n      }\r\n\r\n      res.status(201).json({\r\n        imported: created.length,\r\n        mocks: created,\r\n      })\r\n    } catch (error: any) {\r\n      res.status(400).json({ error: error.message })\r\n    }\r\n  })\r\n\r\n  // Export to OpenAPI\r\n  app.get('/api/export/openapi', async (req, res) => {\r\n    try {\r\n      const mocks = await mockManager.findAll()\r\n      const spec = importer.toOpenAPI(mocks)\r\n      res.json(spec)\r\n    } catch (error: any) {\r\n      res.status(500).json({ error: error.message })\r\n    }\r\n  })\r\n\r\n  // Export to Postman\r\n  app.get('/api/export/postman', async (req, res) => {\r\n    try {\r\n      const mocks = await mockManager.findAll()\r\n      const collection = importer.toPostman(mocks)\r\n      res.json(collection)\r\n    } catch (error: any) {\r\n      res.status(500).json({ error: error.message })\r\n    }\r\n  })\r\n\r\n  // Export to JSON\r\n  app.get('/api/export/json', async (req, res) => {\r\n    try {\r\n      const mocks = await mockManager.findAll()\r\n      const json = importer.toJSON(mocks)\r\n      res.header('Content-Type', 'application/json')\r\n      res.header('Content-Disposition', 'attachment; filename=\"mocks.json\"')\r\n      res.send(json)\r\n    } catch (error: any) {\r\n      res.status(500).json({ error: error.message })\r\n    }\r\n  })\r\n\r\n  // ============ Request Logs ============\r\n  app.get('/api/requests', async (req, res) => {\r\n    try {\r\n      const limit = parseInt(req.query.limit as string) || 100\r\n      const requests = await database.getRecentRequests(limit)\r\n      res.json(requests)\r\n    } catch (error: any) {\r\n      res.status(500).json({ error: error.message })\r\n    }\r\n  })\r\n\r\n  // ============ Stats ============\r\n  app.get('/api/stats', async (req, res) => {\r\n    try {\r\n      const mocks = await mockManager.findAll()\r\n      const enabledMocks = mocks.filter((m) => m.enabled).length\r\n\r\n      res.json({\r\n        totalMocks: mocks.length,\r\n        activeMocks: enabledMocks,\r\n        disabledMocks: mocks.length - enabledMocks,\r\n        aiEnabled: claudeClient.isEnabled(),\r\n      })\r\n    } catch (error: any) {\r\n      res.status(500).json({ error: error.message })\r\n    }\r\n  })\r\n\r\n  // ============ Catch-all: Mock Handler ============\r\n  app.all('*', async (req, res) => {\r\n    const startTime = Date.now()\r\n\r\n    // Find matching mock\r\n    const mock = mockManager.findMatchingMock(req.method, req.path)\r\n\r\n    if (mock) {\r\n      // Apply delay if configured\r\n      if (mock.delay && mock.delay > 0) {\r\n        await new Promise((resolve) => setTimeout(resolve, mock.delay))\r\n      }\r\n\r\n      // Set headers\r\n      if (mock.headers) {\r\n        Object.entries(mock.headers).forEach(([key, value]) => {\r\n          res.setHeader(key, value)\r\n        })\r\n      }\r\n\r\n      // Set cookies\r\n      if (mock.cookies) {\r\n        Object.entries(mock.cookies).forEach(([key, value]) => {\r\n          res.cookie(key, value)\r\n        })\r\n      }\r\n\r\n      // Log the request\r\n      const duration = Date.now() - startTime\r\n      await database.saveRequestLog({\r\n        id: `req_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\r\n        method: req.method,\r\n        path: req.path,\r\n        query: req.query,\r\n        headers: req.headers,\r\n        body: req.body,\r\n        response_status: mock.status,\r\n        response_body: mock.response,\r\n        response_time: duration,\r\n        is_mocked: true,\r\n        mock_id: mock.id,\r\n        timestamp: new Date().toISOString(),\r\n      })\r\n\r\n      console.log(\r\n        `${pc.gray(new Date().toISOString())} ${pc.blue(req.method)} ${pc.green(req.path)} ${pc.green('Mock')}`\r\n      )\r\n\r\n      return res.status(mock.status).json(mock.response)\r\n    }\r\n\r\n    // No mock found - either proxy to backend or return 404\r\n    if (config.backendUrl) {\r\n      console.log(\r\n        `${pc.gray(new Date().toISOString())} ${pc.blue(req.method)} ${pc.yellow(req.path)} ${pc.cyan('Proxy')}`\r\n      )\r\n      return res.status(404).json({\r\n        error: 'Not Found',\r\n        message: 'No mock found and proxy not fully configured',\r\n      })\r\n    }\r\n\r\n    // Log the request as not mocked\r\n    await database.saveRequestLog({\r\n      id: `req_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\r\n      method: req.method,\r\n      path: req.path,\r\n      query: req.query,\r\n      headers: req.headers,\r\n      body: req.body,\r\n      response_status: 404,\r\n      response_body: null,\r\n      response_time: Date.now() - startTime,\r\n      is_mocked: false,\r\n      mock_id: null,\r\n      timestamp: new Date().toISOString(),\r\n    })\r\n\r\n    res.status(404).json({\r\n      error: 'Not Found',\r\n      message: `No mock found for ${req.method} ${req.path}`,\r\n    })\r\n  })\r\n}\r\n","import { WebSocketServer, WebSocket } from 'ws'\r\nimport type { MockManager } from '../mock/manager.js'\r\nimport type { Database } from '../storage/database.js'\r\nimport pc from 'picocolors'\r\n\r\ninterface WSClient {\r\n  id: string\r\n  ws: WebSocket\r\n  subscribedMocks?: string[]\r\n}\r\n\r\nexport function setupWebSocket(\r\n  wss: WebSocketServer,\r\n  mockManager: MockManager,\r\n  database: Database\r\n) {\r\n  const clients: Map<string, WSClient> = new Map()\r\n\r\n  wss.on('connection', (ws: WebSocket) => {\r\n    const clientId = `client_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`\r\n\r\n    const client: WSClient = {\r\n      id: clientId,\r\n      ws,\r\n    }\r\n\r\n    clients.set(clientId, client)\r\n\r\n    console.log(pc.green(`[WebSocket] Client connected: ${clientId}`))\r\n\r\n    // Send welcome message\r\n    ws.send(\r\n      JSON.stringify({\r\n        type: 'CONNECTED',\r\n        data: {\r\n          clientId,\r\n          message: 'Connected to MSW Auto server',\r\n        },\r\n      })\r\n    )\r\n\r\n    // Send current stats\r\n    updateStats()\r\n\r\n    ws.on('message', async (data: Buffer) => {\r\n      try {\r\n        const message = JSON.parse(data.toString())\r\n        handleMessage(client, message)\r\n      } catch (error) {\r\n        console.error(pc.red('[WebSocket] Failed to parse message:'), error)\r\n        ws.send(\r\n          JSON.stringify({\r\n            type: 'ERROR',\r\n            data: { message: 'Invalid message format' },\r\n          })\r\n        )\r\n      }\r\n    })\r\n\r\n    ws.on('close', () => {\r\n      clients.delete(clientId)\r\n      console.log(pc.yellow(`[WebSocket] Client disconnected: ${clientId}`))\r\n    })\r\n\r\n    ws.on('error', (error) => {\r\n      console.error(pc.red(`[WebSocket] Error for client ${clientId}:`), error)\r\n      clients.delete(clientId)\r\n    })\r\n\r\n    function handleMessage(client: WSClient, message: any) {\r\n      switch (message.type) {\r\n        case 'SUBSCRIBE':\r\n          client.subscribedMocks = message.mocks || []\r\n          ws.send(\r\n            JSON.stringify({\r\n              type: 'SUBSCRIBED',\r\n              data: { mocks: client.subscribedMocks },\r\n            })\r\n          )\r\n          break\r\n\r\n        case 'PING':\r\n          ws.send(JSON.stringify({ type: 'PONG', data: { timestamp: Date.now() } }))\r\n          break\r\n\r\n        case 'GET_STATS':\r\n          updateStats()\r\n          break\r\n\r\n        default:\r\n          ws.send(\r\n            JSON.stringify({\r\n              type: 'ERROR',\r\n              data: { message: `Unknown message type: ${message.type}` },\r\n            })\r\n          )\r\n      }\r\n    }\r\n\r\n    async function updateStats() {\r\n      try {\r\n        const mocks = await mockManager.findAll()\r\n        const requests = await database.getRecentRequests(10)\r\n\r\n        const stats = {\r\n          totalMocks: mocks.length,\r\n          activeMocks: mocks.filter((m) => m.enabled).length,\r\n          recentRequests: requests.length,\r\n        }\r\n\r\n        broadcast(\r\n          {\r\n            type: 'STATS',\r\n            data: stats,\r\n          },\r\n          client.id\r\n        )\r\n      } catch (error) {\r\n        console.error(pc.red('[WebSocket] Failed to get stats:'), error)\r\n      }\r\n    }\r\n  })\r\n\r\n  function broadcast(message: any, excludeClientId?: string) {\r\n    const data = JSON.stringify(message)\r\n    clients.forEach((client) => {\r\n      if (client.id !== excludeClientId && client.ws.readyState === WebSocket.OPEN) {\r\n        client.ws.send(data)\r\n      }\r\n    })\r\n  }\r\n\r\n  // Periodic stats update\r\n  setInterval(async () => {\r\n    try {\r\n      const mocks = await mockManager.findAll()\r\n      const requests = await database.getRecentRequests(10)\r\n\r\n      broadcast({\r\n        type: 'STATS',\r\n        data: {\r\n          totalMocks: mocks.length,\r\n          activeMocks: mocks.filter((m) => m.enabled).length,\r\n          recentRequests: requests.length,\r\n        },\r\n      })\r\n    } catch (error) {\r\n      // Silent fail for periodic updates\r\n    }\r\n  }, 30000) // Every 30 seconds\r\n}\r\n","import Anthropic from '@anthropic-ai/sdk'\r\nimport type { Mock, CreateMockDto } from '../mock/manager.js'\r\nimport { PromptBuilder } from './prompt-builder.js'\r\nimport { ResponseParser } from './response-parser.js'\r\nimport pc from 'picocolors'\r\n\r\nexport interface ClaudeConfig {\r\n  apiKey?: string\r\n  baseURL?: string\r\n  model?: string\r\n  maxTokens?: number\r\n}\r\n\r\nexport interface GenerateMockRequest {\r\n  method: string\r\n  path: string\r\n  description?: string\r\n  context?: {\r\n    existingMocks?: Mock[]\r\n    projectInfo?: any\r\n  }\r\n}\r\n\r\nexport class ClaudeClient {\r\n  private client: Anthropic | null = null\r\n  private promptBuilder: PromptBuilder\r\n  private responseParser: ResponseParser\r\n  private config: ClaudeConfig\r\n  private enabled: boolean = false\r\n\r\n  constructor(config: ClaudeConfig = {}) {\r\n    this.config = {\r\n      model: config.model || 'claude-sonnet-4-20250514',\r\n      maxTokens: config.maxTokens || 4096,\r\n      baseURL: config.baseURL,\r\n      ...config,\r\n    }\r\n\r\n    this.promptBuilder = new PromptBuilder()\r\n    this.responseParser = new ResponseParser()\r\n  }\r\n\r\n  async initialize(): Promise<boolean> {\r\n    if (!this.config.apiKey) {\r\n      console.log(pc.yellow('[Claude] API key not configured, AI features disabled'))\r\n      return false\r\n    }\r\n\r\n    try {\r\n      this.client = new Anthropic({\r\n        apiKey: this.config.apiKey,\r\n        baseURL: this.config.baseURL,\r\n      })\r\n\r\n      // Test connection\r\n      await this.client.messages.create({\r\n        model: this.config.model!,\r\n        max_tokens: 10,\r\n        messages: [{ role: 'user', content: 'ping' }],\r\n      })\r\n\r\n      this.enabled = true\r\n      console.log(pc.green('[Claude] Connected successfully'))\r\n      return true\r\n    } catch (error: any) {\r\n      console.error(pc.red('[Claude] Failed to initialize:'), error.message)\r\n      this.enabled = false\r\n      return false\r\n    }\r\n  }\r\n\r\n  isEnabled(): boolean {\r\n    return this.enabled\r\n  }\r\n\r\n  async generateMock(request: GenerateMockRequest): Promise<Partial<Mock>> {\r\n    if (!this.enabled || !this.client) {\r\n      throw new Error('Claude client not initialized')\r\n    }\r\n\r\n    try {\r\n      const prompt = this.promptBuilder.buildMockPrompt(request)\r\n      const systemPrompt = this.promptBuilder.buildSystemPrompt(request.context)\r\n\r\n      const response = await this.client.messages.create({\r\n        model: this.config.model!,\r\n        max_tokens: this.config.maxTokens,\r\n        system: systemPrompt,\r\n        messages: [{ role: 'user', content: prompt }],\r\n      })\r\n\r\n      const content = response.content[0] as any\r\n      const mockData = this.responseParser.parseMockResponse(content.text)\r\n\r\n      console.log(pc.green('[Claude] Mock generated successfully'))\r\n\r\n      return {\r\n        name: mockData.name || request.path,\r\n        method: mockData.method || request.method,\r\n        path: mockData.path || request.path,\r\n        status: mockData.status || 200,\r\n        response: mockData.response || { message: 'Generated by AI' },\r\n        headers: mockData.headers,\r\n        delay: mockData.delay || 0,\r\n        enabled: true,\r\n        description: mockData.description || request.description,\r\n        tags: mockData.tags,\r\n      }\r\n    } catch (error: any) {\r\n      console.error(pc.red('[Claude] Error generating mock:'), error.message)\r\n      throw new Error(`Failed to generate mock: ${error.message}`)\r\n    }\r\n  }\r\n\r\n  async generateMultipleMocks(spec: any): Promise<Partial<Mock>[]> {\r\n    if (!this.enabled || !this.client) {\r\n      throw new Error('Claude client not initialized')\r\n    }\r\n\r\n    try {\r\n      const prompt = this.promptBuilder.buildOpenAPIPrompt(spec)\r\n      const systemPrompt = this.promptBuilder.buildSystemPrompt({})\r\n\r\n      const response = await this.client.messages.create({\r\n        model: this.config.model!,\r\n        max_tokens: this.config.maxTokens,\r\n        system: systemPrompt,\r\n        messages: [{ role: 'user', content: prompt }],\r\n      })\r\n\r\n      const content = response.content[0] as any\r\n      const mocks = this.responseParser.parseMultipleMocks(content.text)\r\n\r\n      console.log(pc.green(`[Claude] Generated ${mocks.length} mocks`))\r\n\r\n      return mocks\r\n    } catch (error: any) {\r\n      console.error(pc.red('[Claude] Error generating mocks:'), error.message)\r\n      throw new Error(`Failed to generate mocks: ${error.message}`)\r\n    }\r\n  }\r\n\r\n  async chat(messages: { role: string; content: string }[], context: any = {}): Promise<string> {\r\n    if (!this.enabled || !this.client) {\r\n      throw new Error('Claude client not initialized')\r\n    }\r\n\r\n    try {\r\n      const systemPrompt = this.promptBuilder.buildSystemPrompt(context)\r\n\r\n      const response = await this.client.messages.create({\r\n        model: this.config.model!,\r\n        max_tokens: this.config.maxTokens,\r\n        system: systemPrompt,\r\n        messages: messages,\r\n      })\r\n\r\n      const content = response.content[0] as any\r\n      return content.text\r\n    } catch (error: any) {\r\n      console.error(pc.red('[Claude] Error in chat:'), error.message)\r\n      throw new Error(`Chat failed: ${error.message}`)\r\n    }\r\n  }\r\n\r\n  async improveMock(mock: Mock, instruction: string): Promise<Partial<Mock>> {\r\n    if (!this.enabled || !this.client) {\r\n      throw new Error('Claude client not initialized')\r\n    }\r\n\r\n    try {\r\n      const prompt = this.promptBuilder.buildImprovePrompt(mock, instruction)\r\n      const systemPrompt = this.promptBuilder.buildSystemPrompt({})\r\n\r\n      const response = await this.client.messages.create({\r\n        model: this.config.model!,\r\n        max_tokens: this.config.maxTokens,\r\n        system: systemPrompt,\r\n        messages: [{ role: 'user', content: prompt }],\r\n      })\r\n\r\n      const content = response.content[0] as any\r\n      const improvedData = this.responseParser.parseMockResponse(content.text)\r\n\r\n      console.log(pc.green('[Claude] Mock improved successfully'))\r\n\r\n      return improvedData\r\n    } catch (error: any) {\r\n      console.error(pc.red('[Claude] Error improving mock:'), error.message)\r\n      throw new Error(`Failed to improve mock: ${error.message}`)\r\n    }\r\n  }\r\n\r\n  async generateDocumentation(mock: Mock): Promise<string> {\r\n    if (!this.enabled || !this.client) {\r\n      throw new Error('Claude client not initialized')\r\n    }\r\n\r\n    try {\r\n      const prompt = this.promptBuilder.buildDocumentationPrompt(mock)\r\n      const systemPrompt = this.promptBuilder.buildDocumentationSystemPrompt()\r\n\r\n      const response = await this.client.messages.create({\r\n        model: this.config.model!,\r\n        max_tokens: this.config.maxTokens,\r\n        system: systemPrompt,\r\n        messages: [{ role: 'user', content: prompt }],\r\n      })\r\n\r\n      const content = response.content[0] as any\r\n      return content.text\r\n    } catch (error: any) {\r\n      console.error(pc.red('[Claude] Error generating documentation:'), error.message)\r\n      throw new Error(`Failed to generate documentation: ${error.message}`)\r\n    }\r\n  }\r\n}\r\n\r\n// Singleton instance\r\nlet claudeClient: ClaudeClient | null = null\r\n\r\nexport function getClaudeClient(config?: ClaudeConfig): ClaudeClient {\r\n  if (!claudeClient) {\r\n    claudeClient = new ClaudeClient(config)\r\n  }\r\n  return claudeClient\r\n}\r\n","import type { GenerateMockRequest, Mock } from './claude-client.js'\r\n\r\nexport class PromptBuilder {\r\n  buildMockPrompt(request: GenerateMockRequest): string {\r\n    const { method, path, description, context } = request\r\n\r\n    let prompt = `\r\nGenerate a realistic mock response for the following API endpoint:\r\n\r\n**HTTP Method:** ${method}\r\n**Path:** ${path}\r\n${description ? `**Description:** ${description}` : ''}\r\n\r\nRequirements:\r\n1. Generate realistic mock data that matches typical API responses\r\n2. Include all necessary fields for a complete response\r\n3. Use appropriate data types (strings, numbers, booleans, arrays, objects)\r\n4. Provide realistic example values\r\n5. Include proper HTTP status code\r\n6. Add optional fields with null values where appropriate\r\n7. Include metadata fields like id, created_at, updated_at where appropriate\r\n\r\nResponse format (JSON):\r\n\\`\\`\\`json\r\n{\r\n  \"name\": \"Descriptive name for this endpoint\",\r\n  \"method\": \"${method}\",\r\n  \"path\": \"${path}\",\r\n  \"status\": 200,\r\n  \"response\": {\r\n    // Your generated mock data here\r\n  },\r\n  \"headers\": {\r\n    \"Content-Type\": \"application/json\"\r\n  },\r\n  \"delay\": 0,\r\n  \"description\": \"Brief description\",\r\n  \"tags\": [\"tag1\", \"tag2\"]\r\n}\r\n\\`\\`\\`\r\n`.trim()\r\n\r\n    // Add context if available\r\n    if (context?.existingMocks && context.existingMocks.length > 0) {\r\n      prompt += `\\n\\nExisting mocks in the project:\\n${JSON.stringify(context.existingMocks.slice(0, 3), null, 2)}`\r\n    }\r\n\r\n    return prompt\r\n  }\r\n\r\n  buildSystemPrompt(context: any = {}): string {\r\n    let prompt = `\r\nYou are an expert API mock generator with deep knowledge of:\r\n\r\n- RESTful API design principles\r\n- GraphQL specifications\r\n- HTTP protocols and status codes\r\n- JSON Schema and data modeling\r\n- Various programming languages and frameworks\r\n\r\nYour core responsibilities:\r\n1. Generate realistic, well-structured mock data\r\n2. Ensure data consistency across related endpoints\r\n3. Follow industry best practices for API design\r\n4. Handle edge cases and error scenarios appropriately\r\n\r\nGuidelines:\r\n- Always return valid JSON\r\n- Use appropriate HTTP status codes (200 for success, 201 for created, 400 for bad request, 404 for not found, 500 for server error)\r\n- Include proper response headers\r\n- Generate realistic example values\r\n- Maintain consistency in naming conventions\r\n- Handle optional fields correctly\r\n- Include error responses when appropriate\r\n- Consider pagination, filtering, and sorting for list endpoints\r\n\r\nWhen generating mock data:\r\n- Use realistic names, emails, phone numbers\r\n- Include appropriate timestamps (ISO 8601 format)\r\n- Generate realistic IDs (UUIDs or integers)\r\n- Include relationship fields (foreign keys)\r\n- Add metadata fields (created_at, updated_at)\r\n- Use appropriate field types matching the data\r\n`.trim()\r\n\r\n    if (context?.projectInfo) {\r\n      prompt += `\\n\\nProject Context:\\n${JSON.stringify(context.projectInfo, null, 2)}`\r\n    }\r\n\r\n    return prompt\r\n  }\r\n\r\n  buildImprovePrompt(mock: Mock, instruction: string): string {\r\n    return `\r\nYou have the following existing mock:\r\n\r\n\\`\\`\\`json\r\n${JSON.stringify(mock, null, 2)}\r\n\\`\\`\\`\r\n\r\nUser wants to improve it with the following instruction:\r\n\"${instruction}\"\r\n\r\nPlease improve the mock according to the instruction while:\r\n1. Maintaining the existing structure\r\n2. Enhancing data quality and realism\r\n3. Adding any missing fields\r\n4. Improving edge case handling\r\n5. Keeping response format consistent\r\n\r\nReturn the improved mock in the same JSON format:\r\n\\`\\`\\`json\r\n{\r\n  \"name\": \"...\",\r\n  \"method\": \"...\",\r\n  \"path\": \"...\",\r\n  \"status\": ...,\r\n  \"response\": { ... },\r\n  \"headers\": { ... },\r\n  \"delay\": ...,\r\n  \"description\": \"...\",\r\n  \"tags\": [...]\r\n}\r\n\\`\\`\\`\r\n`.trim()\r\n  }\r\n\r\n  buildOpenAPIPrompt(openApiSpec: any): string {\r\n    return `\r\nAnalyze the following OpenAPI/Swagger specification and generate mock data for all endpoints:\r\n\r\n\\`\\`\\`json\r\n${JSON.stringify(openApiSpec, null, 2)}\r\n\\`\\`\\`\r\n\r\nFor each endpoint, generate:\r\n1. A successful response (200, 201, etc.)\r\n2. An error response (400, 404, 500, etc.) if applicable\r\n\r\nRequirements:\r\n1. Follow the schema definitions exactly\r\n2. Use realistic example values\r\n3. Handle all required fields\r\n4. Include optional fields with null values where appropriate\r\n5. Generate array responses with multiple items (3-5 items for lists)\r\n6. Maintain consistency across related endpoints\r\n\r\nReturn the result as an array of mock objects:\r\n\\`\\`\\`json\r\n[\r\n  {\r\n    \"name\": \"Get Users\",\r\n    \"method\": \"GET\",\r\n    \"path\": \"/api/users\",\r\n    \"status\": 200,\r\n    \"response\": { \"data\": [...], \"total\": 100 },\r\n    \"headers\": { \"Content-Type\": \"application/json\" },\r\n    \"delay\": 0,\r\n    \"description\": \"Get all users\",\r\n    \"tags\": [\"users\", \"list\"]\r\n  }\r\n]\r\n\\`\\`\\`\r\n`.trim()\r\n  }\r\n\r\n  buildDocumentationPrompt(mock: Mock): string {\r\n    return `\r\nGenerate comprehensive API documentation in Markdown format for the following mock endpoint:\r\n\r\n\\`\\`\\`json\r\n${JSON.stringify(mock, null, 2)}\r\n\\`\\`\\`\r\n\r\nPlease generate documentation that includes:\r\n1. Endpoint overview and description\r\n2. HTTP method and full URL\r\n3. Request parameters (path, query, headers, body)\r\n4. Response structure and status codes\r\n5. Field definitions with types and descriptions\r\n6. Example requests and responses\r\n7. Error codes and handling\r\n\r\nFormat as clean Markdown.\r\n`.trim()\r\n  }\r\n\r\n  buildDocumentationSystemPrompt(): string {\r\n    return `\r\nYou are an expert API documentation generator with deep knowledge of:\r\n- RESTful API documentation standards\r\n- Markdown formatting\r\n- Multiple programming languages\r\n- API design best practices\r\n\r\nYour task is to generate clear, comprehensive API documentation that is:\r\n- Well-structured with proper headings\r\n- Includes all necessary details for developers\r\n- Has clear examples\r\n- Uses proper Markdown syntax\r\n`.trim()\r\n  }\r\n\r\n  buildCodeExamplesPrompt(mock: Mock, languages: string[]): string {\r\n    return `\r\nGenerate code examples for calling the following API endpoint in these languages: ${languages.join(', ')}\r\n\r\nAPI Details:\r\n\\`\\`\\`json\r\n${JSON.stringify(mock, null, 2)}\r\n\\`\\`\\`\r\n\r\nRequirements:\r\n1. Generate complete, working examples for each language\r\n2. Include proper error handling\r\n3. Add comments explaining the code\r\n4. Use popular, well-maintained libraries\r\n5. Include authentication if required\r\n\r\nReturn as JSON:\r\n\\`\\`\\`json\r\n{\r\n  \"javascript\": \"// code here\",\r\n  \"python\": \"# code here\",\r\n  \"curl\": \"curl command here\"\r\n}\r\n\\`\\`\\`\r\n`.trim()\r\n  }\r\n}\r\n","export class ResponseParser {\r\n  parseMockResponse(response: string): any {\r\n    try {\r\n      // Try to extract JSON from code blocks\r\n      const jsonMatch = response.match(/```json\\n([\\s\\S]*?)\\n```/)\r\n\r\n      if (jsonMatch) {\r\n        return JSON.parse(jsonMatch[1])\r\n      }\r\n\r\n      // Try to extract generic code blocks\r\n      const codeMatch = response.match(/```\\n([\\s\\S]*?)\\n```/)\r\n\r\n      if (codeMatch) {\r\n        return JSON.parse(codeMatch[1])\r\n      }\r\n\r\n      // Try to parse entire response\r\n      return JSON.parse(response)\r\n    } catch (error: any) {\r\n      // Try to extract JSON object from response\r\n      const jsonMatch = response.match(/\\{[\\s\\S]*\\}/)\r\n      if (jsonMatch) {\r\n        try {\r\n          return JSON.parse(jsonMatch[0])\r\n        } catch {\r\n          throw new Error(`Failed to parse mock response: ${error.message}`)\r\n        }\r\n      }\r\n\r\n      throw new Error('Invalid mock response format - no valid JSON found')\r\n    }\r\n  }\r\n\r\n  parseMultipleMocks(response: string): any[] {\r\n    try {\r\n      const data = this.parseMockResponse(response)\r\n\r\n      if (Array.isArray(data)) {\r\n        return data\r\n      }\r\n\r\n      if (data.mocks && Array.isArray(data.mocks)) {\r\n        return data.mocks\r\n      }\r\n\r\n      if (data.endpoints && Array.isArray(data.endpoints)) {\r\n        return data.endpoints\r\n      }\r\n\r\n      throw new Error('Invalid multiple mocks response format')\r\n    } catch (error: any) {\r\n      throw new Error(`Failed to parse multiple mocks: ${error.message}`)\r\n    }\r\n  }\r\n\r\n  parseCodeExamples(response: string, languages: string[]): Record<string, string> {\r\n    try {\r\n      const data = this.parseMockResponse(response)\r\n\r\n      const examples: Record<string, string> = {}\r\n\r\n      for (const lang of languages) {\r\n        if (data[lang]) {\r\n          examples[lang] = data[lang]\r\n        }\r\n      }\r\n\r\n      if (Object.keys(examples).length === 0) {\r\n        // Try to extract from code blocks\r\n        languages.forEach((lang) => {\r\n          const regex = new RegExp(`\\`\\`\\`${lang}\\\\n([\\\\s\\\\S]*?)\\\\n\\`\\`\\``, 'i')\r\n          const match = response.match(regex)\r\n          if (match) {\r\n            examples[lang] = match[1]\r\n          }\r\n        })\r\n      }\r\n\r\n      return examples\r\n    } catch (error: any) {\r\n      throw new Error(`Failed to parse code examples: ${error.message}`)\r\n    }\r\n  }\r\n\r\n  parseDocumentation(response: string): string {\r\n    // Remove code block markers\r\n    return response\r\n      .replace(/```[a-z]*\\n?/gi, '')\r\n      .replace(/```/g, '')\r\n      .trim()\r\n  }\r\n}\r\n"],"mappings":"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","names":["import_ws","path","path","fs","pc","path","import_picocolors","claudeClient","path","pc","import_picocolors","pc","client","path","import_picocolors","pc","Anthropic","import_picocolors","import_fs","fs","express","cors","pc"]}